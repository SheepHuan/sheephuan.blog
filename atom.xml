<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Yang Huan&#39;s blog</title>
  
  
  <link href="https://blog.yuanhuan.site/atom.xml" rel="self"/>
  
  <link href="https://blog.yuanhuan.site/"/>
  <updated>2022-06-01T07:24:23.924Z</updated>
  <id>https://blog.yuanhuan.site/</id>
  
  <author>
    <name>Yang Huan</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Docker 配置桌面 + VNC Server</title>
    <link href="https://blog.yuanhuan.site/posts/8ab24eb0/"/>
    <id>https://blog.yuanhuan.site/posts/8ab24eb0/</id>
    <published>2022-06-01T01:55:17.000Z</published>
    <updated>2022-06-01T07:24:23.924Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://pic.yanghuan.site/njGpsc.png" alt="1654066010635.png"></p><h2 id="面向docker-hub构建"><a href="#面向docker-hub构建" class="headerlink" title="面向docker hub构建"></a>面向docker hub构建</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker pull sheephuan/vnc4docker:ubuntu2004-xfce4-20220531</span><br><span class="line"></span><br><span class="line">docker run --privileged -itd -p 22001:22  -p 15901:5901 --name ubuntu-xfce4  vnc-ubuntu2004:xcfe4 /usr/sbin/init</span><br><span class="line"></span><br><span class="line">docker <span class="built_in">exec</span> -it ubuntu-xfce4 /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># vncserver 默认密码123456</span></span><br><span class="line">vncserver :1 -localhost no</span><br></pre></td></tr></table></figure><p><img src="https://pic.yanghuan.site/8K75tJ.png" alt="1654065658384.png"></p><h2 id="从零开始构建"><a href="#从零开始构建" class="headerlink" title="从零开始构建"></a>从零开始构建</h2><h3 id="构建Dokcer"><a href="#构建Dokcer" class="headerlink" title="构建Dokcer"></a>构建Dokcer</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker pull ubuntu:focal-20200423</span><br><span class="line"></span><br><span class="line"><span class="comment"># -v hostdir:dockerdir</span></span><br><span class="line"><span class="comment"># 注意这样启动 无法正常使用systemctl命令</span></span><br><span class="line">docker run -it -p 22001:22  -p 15902:5901 --name xfce4 ubuntu:focal-20200423 /bin/bash</span><br><span class="line"><span class="comment">#启动</span></span><br><span class="line">docker <span class="built_in">exec</span> -it huany /bin/bash</span><br></pre></td></tr></table></figure><h3 id="apt换源"><a href="#apt换源" class="headerlink" title="apt换源"></a><code>apt</code>换源</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 备份</span></span><br><span class="line"><span class="built_in">cp</span> /etc/apt/sources.list /etc/apt/sources.list.bak</span><br><span class="line"><span class="built_in">rm</span> /etc/apt/sources.list</span><br><span class="line">vim /etc/apt/sources.list</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="阿里云"><a href="#阿里云" class="headerlink" title="阿里云"></a>阿里云</h4><p><a href="https://developer.aliyun.com/mirror/ubuntu">https://developer.aliyun.com/mirror/ubuntu</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">deb http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="line"></span><br><span class="line"># deb http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse</span><br><span class="line"># deb-src http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse</span><br></pre></td></tr></table></figure><h4 id="清华开源镜像站"><a href="#清华开源镜像站" class="headerlink" title="清华开源镜像站"></a>清华开源镜像站</h4><p><a href="https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/">https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 20.04 LTS</span><br><span class="line"># 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释</span><br><span class="line"># 记得把https换成http</span><br><span class="line">deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse</span><br><span class="line"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse</span><br><span class="line">deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="line"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="line">deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse</span><br><span class="line"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse</span><br><span class="line">deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse</span><br><span class="line"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse</span><br><span class="line"></span><br><span class="line"># 预发布软件源，不建议启用</span><br><span class="line"># deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse</span><br><span class="line"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse</span><br></pre></td></tr></table></figure><h4 id="中科大"><a href="#中科大" class="headerlink" title="中科大"></a>中科大</h4><p><a href="https://mirrors.ustc.edu.cn/help/ubuntu.html?highlight=ubuntu">https://mirrors.ustc.edu.cn/help/ubuntu.html?highlight=ubuntu</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认注释了源码仓库，如有需要可自行取消注释</span></span><br><span class="line">deb http://mirrors.ustc.edu.cn/ubuntu/ focal main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.ustc.edu.cn/ubuntu/ focal main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line">deb http://mirrors.ustc.edu.cn/ubuntu/ focal-security main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.ustc.edu.cn/ubuntu/ focal-security main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line">deb http://mirrors.ustc.edu.cn/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.ustc.edu.cn/ubuntu/ focal-updates main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line">deb http://mirrors.ustc.edu.cn/ubuntu/ focal-backports main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.ustc.edu.cn/ubuntu/ focal-backports main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 预发布软件源，不建议启用</span></span><br><span class="line"><span class="comment"># deb https://mirrors.ustc.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse</span></span><br><span class="line"><span class="comment"># deb-src https://mirrors.ustc.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse</span></span><br></pre></td></tr></table></figure><h3 id="安装桌面环境-xfce4-tigervnc"><a href="#安装桌面环境-xfce4-tigervnc" class="headerlink" title="安装桌面环境 xfce4+tigervnc"></a>安装桌面环境 xfce4+tigervnc</h3><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt install xfce4 xfce4-goodies -y</span><br><span class="line">apt install tigervnc-standalone-server -y</span><br></pre></td></tr></table></figure><h4 id="配置vnc"><a href="#配置vnc" class="headerlink" title="配置vnc"></a>配置vnc</h4><h5 id="设置vnc密码"><a href="#设置vnc密码" class="headerlink" title="设置vnc密码"></a>设置vnc密码</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置vnc密码</span></span><br><span class="line">vncpasswd</span><br><span class="line"><span class="comment"># 输入两次密码</span></span><br><span class="line"><span class="comment"># 第三次的view-only password  输入 n 即可</span></span><br></pre></td></tr></table></figure><h5 id="设置vnc启动桌面"><a href="#设置vnc启动桌面" class="headerlink" title="设置vnc启动桌面"></a>设置vnc启动桌面</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编写xstartup文件，</span></span><br><span class="line">vim /root/.vnc/xstartup</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#输入以下内容</span></span><br><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line"><span class="built_in">unset</span> SESSION_MANAGER</span><br><span class="line"><span class="built_in">unset</span> DBUS_SESSION_BUS_ADDRESS</span><br><span class="line"><span class="built_in">exec</span> startxfce4 </span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置启动权限</span></span><br><span class="line"><span class="built_in">chmod</span> u+x /root/.vnc/xstartup</span><br></pre></td></tr></table></figure><h5 id="设置vnc显示选项"><a href="#设置vnc显示选项" class="headerlink" title="设置vnc显示选项"></a>设置vnc显示选项</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># in /root/.vnc/config</span><br><span class="line"># vim /root/.vnc/config</span><br><span class="line">geometry=1920x1080</span><br><span class="line">dpi=128</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="启动vnc"><a href="#启动vnc" class="headerlink" title="启动vnc"></a>启动vnc</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -localhost no表示其他IP可以访问，否则只能本地访问</span></span><br><span class="line">vncserver -localhost no </span><br></pre></td></tr></table></figure><h5 id="设置-VNC-为-系统服务-我没做"><a href="#设置-VNC-为-系统服务-我没做" class="headerlink" title="设置 VNC 为 系统服务(我没做)"></a><del>设置 VNC 为 系统服务(我没做</del>)</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/systemd/system/vncserver@.service</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Remote desktop service (VNC)</span><br><span class="line">After=syslog.target network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">User=linuxize</span><br><span class="line">PAMName=login</span><br><span class="line">PIDFile=/home/%u/.vnc/%H%i.pid</span><br><span class="line">ExecStartPre=/bin/sh -c &#x27;/usr/bin/vncserver -kill :%i &gt; /dev/null 2&gt;&amp;1 || :&#x27;</span><br><span class="line">ExecStart=/usr/bin/vncserver :%i -geometry 1920x1080 -alwaysshared -fg</span><br><span class="line">ExecStop=/usr/bin/vncserver -kill :%i</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><p>保存此文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置文件生效</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line"><span class="comment"># 设为开机启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> vncserver@1.service</span><br><span class="line">systemctl start vncserver@1.service</span><br><span class="line">systemctl status vncserver@1.service</span><br></pre></td></tr></table></figure><h4 id="打包镜像"><a href="#打包镜像" class="headerlink" title="打包镜像"></a>打包镜像</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">docker commit xfce4 vnc-ubuntu2004:xcfe4</span><br><span class="line"></span><br><span class="line"><span class="comment"># 容器长传</span></span><br><span class="line">docker tag vnc-ubuntu2004:xcfe4 sheephuan/vnc4docker:ubuntu2004-xfce4-20220531</span><br><span class="line">docker login</span><br><span class="line">docker push sheephuan/vnc4docker:ubuntu2004-xfce4-20220531</span><br><span class="line"></span><br><span class="line">docker save -o vnc-ubuntu2004-xcfe4.tar vnc-ubuntu2004:xcfe4</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在新服务载入</span></span><br><span class="line">docker load --input vnc-ubuntu2004-xcfe4.tar</span><br></pre></td></tr></table></figure><p>考虑学习写一个Dockerfile</p><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><h3 id="System-has-not-been-booted-with-systemd-as-init-system-PID-1-Can’t-operate"><a href="#System-has-not-been-booted-with-systemd-as-init-system-PID-1-Can’t-operate" class="headerlink" title="System has not been booted with systemd as init system (PID 1). Can’t operate."></a>System has not been booted with systemd as init system (PID 1). Can’t operate.</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --privileged -itd -p 22004:22  -p 15904:5901 --name txfce4 vnc-ubuntu2004:xcfe4 /usr/sbin/init</span><br></pre></td></tr></table></figure><h3 id="Failed-to-exec-default-Terminal-Emulator"><a href="#Failed-to-exec-default-Terminal-Emulator" class="headerlink" title="Failed to exec default Terminal Emulator"></a>Failed to exec default Terminal Emulator</h3><p><img src="https://pic.yanghuan.site/JgbQSP.png" alt="1653997211716.png"></p><p><a href="https://blog.csdn.net/weixin_42912498/article/details/107162983">https://blog.csdn.net/weixin_42912498/article/details/107162983</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://pic.yanghuan.site/njGpsc.png&quot; alt=&quot;1654066010635.png&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;面向docker-hub构建&quot;&gt;&lt;a href=&quot;#面向docker-hub构建&quot; class=&quot;hea</summary>
      
    
    
    
    <category term="开发环境" scheme="https://blog.yuanhuan.site/categories/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"/>
    
    
    <category term="Docker" scheme="https://blog.yuanhuan.site/tags/Docker/"/>
    
    <category term="Linux" scheme="https://blog.yuanhuan.site/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="https://blog.yuanhuan.site/posts/4a17b156/"/>
    <id>https://blog.yuanhuan.site/posts/4a17b156/</id>
    <published>2022-05-08T02:36:42.444Z</published>
    <updated>2022-05-08T02:39:36.424Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot;&gt;documentation&lt;/a&gt; for</summary>
      
    
    
    
    
  </entry>
  
</feed>
